import{a as S,r as m,j as e,B as g,T as V}from"./index-7ee441ac.js";import{F as L,B as C}from"./index-e9bb2c94.js";import{C as p}from"./cuIcon-525887b3.js";import{D as G}from"./index-955c3fda.js";import{u as H,g as R}from"./viewdata-73f96ad8.js";import{h as A}from"./http-21f83e32.js";import{N as M}from"./novelCardList-dac555c4.js";import{F as n}from"./index-ac544244.js";import{C as q}from"./index-e1fd296a.js";import{I as J,S as K}from"./index-d7749322.js";import{B as Q}from"./index-cd74f31e.js";import{C as I}from"./index-8a5d6158.js";import{T as U}from"./index-ac6a781e.js";import"./index-ab6ddabd.js";import"./create-global-store-da266218.js";import"./index-f93ef5ae.js";import"./EllipsisOutlined-936bc574.js";import"./LeftOutlined-3072315e.js";const W="_search_44yr3_1",X="_zhanwei_44yr3_10",Y="_searchtitle_44yr3_14",Z="_searchcard_44yr3_28",ee="_searchScroll_44yr3_38",se="_cardindex_44yr3_98",te="_carppeizhu_44yr3_103",ae="_cardtitle_44yr3_111",re="_cardbut_44yr3_119",ie="_searchFormItem_44yr3_123",u={search:W,zhanwei:X,searchtitle:Y,searchcard:Z,searchScroll:ee,cardindex:se,carppeizhu:te,cardtitle:ae,cardbut:re,searchFormItem:ie},ne=[{icon:e.jsx(p,{icon:"medal",className:"mr-10",isTransiton:!1}),align:"left",txt:"完结"},{icon:e.jsx(p,{icon:"tag",className:"ml-10",isTransiton:!1}),align:"right",txt:"连载"}],oe=[{icon:e.jsx(p,{icon:"medal",className:"mr-10",isTransiton:!1}),align:"left",txt:"隐藏"},{icon:e.jsx(p,{icon:"tag",className:"ml-10",isTransiton:!1}),align:"right",value:!0,txt:"显示"}];let _=!1;const Ce=()=>{const[o]=n.useForm(),[l,{toggle:T}]=S(!0),{tabs:x,novelData:r,initTabs:$,initNovel:P}=H(),[c,h]=m.useState([]),[d,z]=m.useState(10),[i,y]=m.useState(""),[w,{set:v}]=S(!0);m.useEffect(()=>{b()},[r]);const b=async s=>{try{await $(),await P()}finally{h(R().novelData.slice(0,10)),y(""),!l&&o.resetFields(),_=!1,!w&&v(!0),setTimeout(()=>{s&&s()},1e3)}},O=async()=>{var N,F;_=!0;const s=[],a=[];if(i&&(a.push({title:{$regex:i}}),a.push({beizhu:{$regex:i}})),o){const t=o.getFieldsValue();t.tabs&&t.tabs.forEach(j=>{a.push({tabs:j})}),(N=t.wanjie)!=null&&N.value&&(t.wanjie=t.wanjie.index,a.push({wanjie:t.wanjie})),(F=t.isdel)!=null&&F.value?(t.isdel=t.isdel.index,s.push({isdel:t.isdel})):(t.isdel=1,s.push({isdel:t.isdel}))}if(!i&&a.length===0){window.$message.warning("请输入搜索内容");return}const E={$or:a,$and:s};let f=await A.post("/curd-mongo/find/novel",{ops:{many:!0},where:E}).catch(t=>(window.$message.error("搜索不出东西"),Promise.reject(t)));f=f.map(t=>(t.tabs=t.tabs.map(j=>x.find(k=>k.tab===j)),t)).reverse(),h(f)},B=s=>{_||(d+10<=r.length?(s({opacity:1}),h(a=>a.concat(r.slice(d,d+10))),z(d+10)):setTimeout(()=>{s({opacity:0}),v(!1)},1e3))};function D(){if(c.length<r.length){let s=r.slice(c.length,r.length);h(c.concat(s))}}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-100-vh",children:[e.jsx(q,{className:`${u.search} ${u.searchcard}`,hoverable:!0,title:e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsxs("div",{className:`${u.searchtitle} flex-ai-c`,children:[e.jsx(J,{placeholder:"名",variant:"filled",type:"Primary",value:i,onChange:s=>y(s.target.value)}),e.jsx(g,{type:"text",className:"ml-5",onClick:O,children:e.jsx(K,{})}),e.jsx(g,{type:"text",onClick:T,children:e.jsx(Q,{style:{color:l?"":"var(--primary-color)"}})}),e.jsx(g,{type:"text",onClick:D,children:e.jsx(L,{})})]})})}),children:e.jsx(V,{show:l,children:l?e.jsx("p",{}):e.jsx(e.Fragment,{children:e.jsxs(n,{className:u.searchFormItem,form:o,children:[e.jsx(n.Item,{name:"tabs",children:e.jsx(I.Group,{children:x.length>0&&x.map(s=>e.jsx(I,{value:s.tab,style:{lineHeight:"32px"},children:e.jsx(U,{color:s.color,children:s.tab})},s.tab))})}),e.jsx(n.Item,{name:"wanjie",className:"mt-10",children:e.jsx(C,{options:ne})}),e.jsx(n.Item,{name:"isdel",className:"mt-10",children:e.jsx(C,{options:oe})})]})})})}),e.jsx(G,{onEnd:b,onPullup:B,isMount:!1,isOnPullup:w,headerPosition:e.jsx("div",{style:{height:"calc(var(--Header-height) + 3.3vh)"}}),children:e.jsx("div",{className:"flex-ai-c flex-wrap",children:e.jsx(M,{data:c})})})]})})};export{Ce as default};
