import{r as f,q as v}from"./index-2bee2ced.js";import{c as x}from"./create-global-store-ba03d94f.js";import{h}from"./http-01df503a.js";function p(){for(var r=Math.floor(Math.random()*16777216).toString(16);r.length<6;)r="0"+r;return"#"+r}const[N,s]=x(()=>{const[r,i]=f.useState([]),[o,a]=f.useState([]);function g(){i([]),setNovel({action:!1,data:{},novelList:[]})}const c=async()=>{var e;if(!s().tabs.length)try{const t=await h.get("/json-get",{ph:"tabs.json"});return i(()=>t.map(n=>({tab:n,color:p()}))),1}catch(t){return(e=window.$message)!=null&&e.error&&window.$message.error("获取类型标签失败 ："+t),Promise.reject(t)}},l=async e=>{if(!e&&s().tabs.length>0&&s().novelData.length>0)return;let t=await h.post("/curd-mongo/find/novel",{ops:{many:!0},where:{isdel:1}});t.length!==0&&(t=t.reverse(),t=t.map(n=>(n.tabs=n.tabs.map(u=>{const d=r.find(w=>w.tab===u);return d||{tab:u,color:p()}}),n)),a(t))};function m(e){const t=o.findIndex(n=>n._id===e);return t===-1?0:(o.splice(t,1),a([].concat(o)),1)}function b(e){const t=o.findIndex(n=>n._id===e._id);if(t===-1)return 0;o[t]=e,a([].concat(o))}return v(()=>{c().then(l(!0))}),{tabs:r,setTabs:i,novelData:o,setNovelData:a,updateNovelItem:b,deleteNovelItem:m,initTabs:c,initNovel:l,clearNovel:g}}),I=N,j=s;export{j as g,p as r,I as u};
