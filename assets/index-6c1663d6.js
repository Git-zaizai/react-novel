import{r as x,j as e,a as K,B as L,T as U}from"./index-7ee441ac.js";import{F as W,B as G}from"./index-e9bb2c94.js";import{C as k}from"./cuIcon-525887b3.js";import"./index-955c3fda.js";import{u as Z}from"./viewdata-73f96ad8.js";import{h as ee}from"./http-21f83e32.js";import{N as te}from"./novelCardList-dac555c4.js";import{F as $}from"./index-ac544244.js";import{C as se}from"./index-e1fd296a.js";import{I as ne,S as oe}from"./index-d7749322.js";import{C as q}from"./index-8a5d6158.js";import{T as ae}from"./index-ac6a781e.js";import{S as ie}from"./index-d7c9ffe2.js";import{B as re}from"./index-cd74f31e.js";import"./index-ab6ddabd.js";import"./create-global-store-da266218.js";import"./index-f93ef5ae.js";import"./EllipsisOutlined-936bc574.js";import"./LeftOutlined-3072315e.js";const le="_search_1bfcm_1",ce="_zhanwei_1bfcm_10",de="_searchtitle_1bfcm_14",pe="_searchcard_1bfcm_23",ue="_searchScroll_1bfcm_33",he="_searchview_1bfcm_82",me="_cardindex_1bfcm_97",fe="_carppeizhu_1bfcm_102",xe="_cardtitle_1bfcm_110",_e="_cardbut_1bfcm_118",je="_searchFormItem_1bfcm_122",we="_footerposition_1bfcm_131",y={search:le,zhanwei:ce,searchtitle:de,searchcard:pe,searchScroll:ue,searchview:he,cardindex:me,carppeizhu:fe,cardtitle:xe,cardbut:_e,searchFormItem:je,footerposition:we},ge="_DropdownPullupView_1j25j_2",be="_spincontainer_1j25j_9",ve="_Dropdown_1j25j_2",Se="_DropdownIconView_1j25j_36",Ie="_loader_1j25j_42",ye="_loaderBack_1j25j_51",Ne="_loaderAnimation_1j25j_61",De="_loadingskKeyframes_1j25j_1",Te="_content_1j25j_65",Ce="_Hitbottom_1j25j_71",ze="_rotate180_1j25j_1",r={DropdownPullupView:ge,spincontainer:be,Dropdown:ve,DropdownIconView:Se,loader:Ie,loaderBack:ye,loaderAnimation:Ne,loadingskKeyframes:De,content:Te,Hitbottom:Ce,rotate180:ze},J=100,F=70,X=20,N=.5;let S=0,Y=0,v=0,V=0,o=0,O=0,D=!1,M=0,l=N;function $e(d){M>0||D||(S=d.touches[0].clientY,Y=d.touches[0].clientX)}const Fe=d=>{const{onPullup:_,onDropdown:I,children:T,InfiniteDropdown:a=!1,isMountDropdown:A=!1,PullupChildren:E,DropdownChildren:i,top:j="-30px",isMount:w=!1}=d,C=x.useRef(null),[z,g]=x.useState({"--zai-translateY":"0px","--zai-loader-scale":N}),[p,h]=x.useState({status:0,text:"加载中...",pullupShow:!1,pullupIconShow:!0,spincontainer:!1});function m(n){S=0,Y=0,v=0,V=0,o=0,O=0,D=!1,M=0,l=N,g({"--zai-translateY":"0px","--zai-loader-scale":N}),h({status:0,text:"加载中...",pullupShow:!0,pullupIconShow:!0,spincontainer:!1,...n})}function H(n){const{scrollHeight:u,clientHeight:f,scrollTop:b}=n.target;M=b,f+b>=u&&_&&(h(P=>({...P,spincontainer:!0})),_(m))}function t(n){if(M>0||(v=n.touches[0].clientY,V=n.touches[0].clientX,D)||v-S<0)return;if(p.status!==1&&h(b=>({...b,status:1})),o=v-S,O=V-Y,Math.atan(Math.abs(O)/o)*(180/Math.PI)>F){[S,Y]=[v,V];return}let f=(100-o*.5)/100;f=Math.max(.5,f),o=o*f,o>=J&&(a||(o=J)),o>X&&(l=(o-X)/(F-X),l=Math.min(l,1),l=l<N?N:l),g({"--zai-translateY":o+"px","--zai-loader-scale":l})}function c(){M>0||D||v-S<0||(o<F?m():(D=!0,h(n=>({...n,status:2,spincontainer:!0})),g(n=>({...n,"--zai-translateY":F+"px","--zai-loader-scale":l})),I&&I(m)))}return x.useEffect(()=>{var n;if(w){I(m);return}else A?(D=!1,v=10,S=1,o=F,l=1,g({"--zai-translateY":o+"px","--zai-loader-scale":l}),h(u=>({...u,status:2,spincontainer:!0})),I(m)):(((n=C.current)==null?void 0:n.offsetHeight)??0)>0&&h(f=>({...f,pullupShow:!0}));return()=>{m()}},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:`${r.DropdownPullupView} ${p.spincontainer&&r.spincontainer}`,style:z,children:[e.jsx("div",{className:r.Dropdown,style:{top:j,opacity:p.status!==0?"1":"0"},children:e.jsx("div",{className:r.DropdownIconView,children:e.jsx("i",{className:`${r.loader}  ${p.status===2&&r.loaderAnimation}`,style:{transform:"scale(var(--zai-loader-scale))"}})})}),e.jsxs("div",{ref:C,id:"dropdown-pullup",className:`${r.content}`,onTouchStart:$e,onTouchMove:t,onTouchEnd:c,onScroll:H,children:[i,T,p.pullupShow&&e.jsx("div",{className:r.Hitbottom,children:e.jsxs("div",{className:r.DropdownIconView,children:[e.jsx("i",{className:`${r.loader} ${r.loaderAnimation}`,style:{display:p.pullupIconShow?"block":"none"}}),p.text]})}),E]})]})})},Me=[{icon:e.jsx(k,{icon:"medal",className:"mr-10",isTransiton:!1}),align:"left",txt:"完结"},{icon:e.jsx(k,{icon:"tag",className:"ml-10",isTransiton:!1}),align:"right",txt:"连载"}],Pe=[{icon:e.jsx(k,{icon:"medal",className:"mr-10",isTransiton:!1}),align:"left",txt:"隐藏"},{icon:e.jsx(k,{icon:"tag",className:"ml-10",isTransiton:!1}),align:"right",value:!0,txt:"显示"}];let R=!1;const et=()=>{const[d]=$.useForm(),[_,{toggle:I}]=K(!0),{tabs:T,novelData:a,initTabs:A,initNovel:E}=Z(),[i,j]=x.useState(a.slice(0,10)),[w,C]=x.useState(""),[z,{toggle:g}]=K(!1),p=async t=>{try{a.length===0&&(await A(),await E())}finally{(i.length>10||i.length===0)&&j(a.slice(0,10)),C(""),!_&&d.resetFields(),R=!1,setTimeout(()=>{t&&t()},1e3)}},h=async()=>{var b,P;R=!0;const t=[],c=[];if(w&&(c.push({title:{$regex:w}}),c.push({beizhu:{$regex:w}})),d){const s=d.getFieldsValue();s.tabs&&s.tabs.forEach(B=>{c.push({tabs:B})}),(b=s.wanjie)!=null&&b.value&&(s.wanjie=s.wanjie.index,c.push({wanjie:s.wanjie})),(P=s.isdel)!=null&&P.value?(s.isdel=s.isdel.index,t.push({isdel:s.isdel})):(s.isdel=1,t.push({isdel:s.isdel}))}if(!w&&c.length===0){window.$message.warning("请输入搜索内容");return}const n={$or:c,$and:t};let u=await ee.post("/curd-mongo/find/novel",{ops:{many:!0},where:n}).catch(s=>(window.$message.error("搜索不出东西"),Promise.reject(s)));u=u.map(s=>(s.tabs=s.tabs.map(B=>T.find(Q=>Q.tab===B)),s)).reverse(),j(u)},m=t=>{R||(i.length-1<a.length-1?setTimeout(()=>{j(c=>c.concat(a.slice(i.length-1,i.length-1+10))),t()},1e3):t({pullupIconShow:!1,text:"没有了..."}))};function H(){if(i.length<a.length){g();let t=a.slice(i.length,a.length);j(i.concat(t))}}return x.useEffect(()=>{z&&setTimeout(()=>{g()},1e3)},[z]),x.useEffect(()=>{j(a.slice(0,i.length))},[a]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:`h-100-vh ${y.searchview}`,children:[e.jsx(se,{className:`${y.search} ${y.searchcard}`,hoverable:!0,title:e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsxs("div",{className:`${y.searchtitle} flex-ai-c`,children:[e.jsx(ne,{placeholder:"名",variant:"filled",type:"Primary",value:w,onChange:t=>C(t.target.value)}),e.jsx(L,{type:"text",className:"ml-5",onClick:h,children:e.jsx(oe,{})}),e.jsx(L,{type:"text",onClick:I,children:e.jsx(re,{style:{color:_?"":"var(--primary-color)"}})}),e.jsx(L,{type:"text",onClick:H,children:e.jsx(W,{})})]})})}),children:e.jsx(U,{show:_,children:_?e.jsx("p",{}):e.jsx(e.Fragment,{children:e.jsxs($,{className:y.searchFormItem,form:d,children:[e.jsx($.Item,{name:"tabs",children:e.jsx(q.Group,{children:T.length>0&&T.map(t=>e.jsx(q,{value:t.tab,style:{lineHeight:"32px"},children:e.jsx(ae,{color:t.color,children:t.tab})},t.tab))})}),e.jsx($.Item,{name:"wanjie",className:"mt-10",children:e.jsx(G,{options:Me})}),e.jsx($.Item,{name:"isdel",className:"mt-10",children:e.jsx(G,{options:Pe})})]})})})}),e.jsx(ie,{size:"large",delay:300,spinning:z,children:e.jsx(Fe,{onDropdown:p,onPullup:m,InfiniteDropdown:!0,top:"140px",DropdownChildren:e.jsx("div",{style:{height:"160px"}}),PullupChildren:e.jsx("div",{className:y.footerposition}),children:e.jsx("div",{className:"flex-ai-c flex-wrap",children:e.jsx(te,{data:i})})})})]})})};export{et as default};
