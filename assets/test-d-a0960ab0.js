import{r,j as t,a as Y,B as H}from"./index-7ee441ac.js";import"./index-955c3fda.js";import{u as R,g as X}from"./viewdata-73f96ad8.js";import"./http-21f83e32.js";import{N as B}from"./novelCardList-dac555c4.js";import{F as K}from"./index-ac544244.js";import{S as O}from"./index-d7c9ffe2.js";import"./index-ab6ddabd.js";import"./create-global-store-da266218.js";import"./cuIcon-525887b3.js";import"./index-f93ef5ae.js";import"./index-e1fd296a.js";import"./EllipsisOutlined-936bc574.js";import"./index-cd74f31e.js";import"./LeftOutlined-3072315e.js";import"./index-ac6a781e.js";const q="_DropdownPullupView_1j82x_2",G="_spincontainer_1j82x_9",J="_Dropdown_1j82x_2",Q="_DropdownIconView_1j82x_37",U="_loader_1j82x_43",W="_loaderBack_1j82x_52",Z="_loaderAnimation_1j82x_62",ee="_loadingskKeyframes_1j82x_1",te="_content_1j82x_66",oe="_Hitbottom_1j82x_72",se="_rotate180_1j82x_1",a={DropdownPullupView:q,spincontainer:G,Dropdown:J,DropdownIconView:Q,loader:U,loaderBack:W,loaderAnimation:Z,loadingskKeyframes:ee,content:te,Hitbottom:oe,rotate180:se},C=100,v=70,M=20,p=.5;let f=0,P=0,d=0,V=0,o=0,A=0,m=!1,j=0,n=p;function k(u){j>0||m||(f=u.touches[0].clientY,P=u.touches[0].clientX)}const ne=u=>{const{onPullup:g,onDropdown:S,children:T,InfiniteDropdown:i=!1,isMountDropdown:E=!1}=u,D=r.useRef(null),[I,l]=r.useState({"--zai-translateY":"0px","--zai-loader-scale":p}),[s,c]=r.useState({status:0,text:"加载中...",pullupShow:!1,pullupIconShow:!0}),b=e=>{l({"--zai-translateY":"0px","--zai-loader-scale":p}),c({status:0,text:"加载中...",pullupShow:!1,pullupIconShow:!0,...e})};function z(e){console.log(j);const{scrollHeight:w,clientHeight:_,scrollTop:N}=e.target;j=N,_+N>=w&&g&&(c(F=>({...F,status:3})),g(b))}function y(e){if(j>0||(d=e.touches[0].clientY,V=e.touches[0].clientX,m)||d-f<0)return;if(o=d-f,A=V-P,Math.atan(Math.abs(A)/o)*(180/Math.PI)>v){[f,P]=[d,V];return}let _=(100-o*.5)/100;_=Math.max(.5,_),o=o*_,o>=C&&(s.status!==1&&c(N=>({...N,status:1})),i||(o=C)),o>M&&(n=(o-M)/(v-M),n=Math.min(n,1),n=n<p?p:n),l({"--zai-translateY":o+"px","--zai-loader-scale":n})}function h(){o=0,A=0,m=!1,n=p,c(e=>({...e,status:0,pullupShow:!0})),l({"--zai-translateY":"0px","--zai-loader-scale":n})}function x(){j>0||m||d-f<0||(o<v?h():(m=!0,c(e=>({...e,status:2})),l(e=>({...e,"--zai-translateY":v+"px","--zai-loader-scale":n})),S&&S(h)))}function L(){const e=D.current;return e&&(e.addEventListener("touchstart",k,{passive:!1}),e.addEventListener("touchmove",y,{passive:!1}),e.addEventListener("touchend",x,{passive:!1})),()=>{e&&(e.removeEventListener("touchstart",k),e.removeEventListener("touchmove",y),e.removeEventListener("touchend",x))}}return r.useLayoutEffect(()=>L(),[]),r.useEffect(()=>{E&&(m=!1,d=10,f=1,o=v,n=1,l({"--zai-translateY":o+"px","--zai-loader-scale":n}),c(e=>({...e,status:2})),S(h))},[]),t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${a.DropdownPullupView} ${s.status!==0&&a.spincontainer}`,style:I,children:[t.jsx("div",{className:a.Dropdown,children:t.jsx("div",{className:a.DropdownIconView,children:t.jsx("i",{className:`${a.loader}  ${s.status===2&&a.loaderAnimation}`,style:{transform:"scale(var(--zai-loader-scale))"}})})}),t.jsxs("div",{ref:D,id:"dropdown-pullup",className:`${a.content}`,onScroll:z,children:[T,s.pullupShow&&t.jsx("div",{className:a.Hitbottom,children:t.jsxs("div",{className:a.DropdownIconView,children:[t.jsx("i",{className:`${a.loader} ${a.loaderAnimation}`,style:{display:s.pullupIconShow?"block":"none"}}),s.text]})})]})]})})};let $=!1;function ge(){const[u]=K.useForm(),[g,{toggle:S}]=Y(!0),{tabs:T,novelData:i,initTabs:E,initNovel:D}=R(),[I,l]=r.useState(i.slice(0,10)),[s,c]=r.useState(10),[b,z]=r.useState(""),[y,{set:h}]=Y(!0);Y(!1),r.useEffect(()=>{x(()=>{})},[i]);const x=async e=>{try{i.length===0&&(await E(),await D())}finally{l(X().novelData.slice(0,10)),z(""),!g&&u.resetFields(),$=!1,!y&&h(!0),setTimeout(()=>{e&&e()},1e3)}},L=e=>{$||(console.log(s,I,i.length,e),s+10<=i.length&&(l(w=>(console.log(w),[...w,...i.slice(s,s+10)])),c(s+10)),e())};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{height:"80px",border:"1px solid var(--primary-color-pressed)"},children:t.jsxs("div",{className:"flex-ai-c w-100",children:[t.jsx("i",{className:`${a.loader}`,style:{transform:"scale(var(--zai-loader-scale))"}}),t.jsx(H,{onClick:()=>{document.querySelector("#dropdown-pullup").scrollTo({top:0,behavior:"smooth"})},children:"1"})]})}),t.jsx("div",{style:{height:"1px",width:"100%",backgroundColor:"#000",position:"fixed",zIndex:"999",top:"33vh"}}),t.jsx(O,{spinning:!1,children:t.jsx("div",{style:{height:"calc(100vh - 80px)"},children:t.jsx(ne,{onPullup:L,onDropdown:x,InfiniteDropdown:!0,isMountDropdown:!0,children:t.jsx("div",{className:"flex-ai-c flex-wrap",children:t.jsx(B,{data:I})})})})})]})}export{ge as default};
