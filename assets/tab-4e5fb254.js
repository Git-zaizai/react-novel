import{r as p,j as e,a as b}from"./index-cb5f5546.js";import{V as v}from"./index-b514134e.js";import{C as l}from"./cuIcon-4967541d.js";import{a as y,S as C,T as z}from"./Transition-45e03733.js";import{u as N,ag as F,B as j,a as I,I as $,h}from"./viewdata-f41ba799.js";import{C as S}from"./index-19be1c8c.js";import{F as R}from"./index-c79a38a3.js";import"./index-f181448a.js";const B="_view_x24d7_1",E="_circleCard_x24d7_5",P="_addForm_x24d7_12",g={view:B,circleCard:E,addForm:P};function A(){const[n,{setLeft:m,setRight:f}]=I(),{tabs:c,setTabs:x}=N(),[o,a]=p.useState([]),[r,d]=p.useState(""),u=(s,t)=>{if(s.checked=!s.checked,c[t]=s,s.checked)o.push(s),a(o);else{const i=o.findIndex(w=>w.tab===s.tab);o.splice(i,1),a(o),setTimeout(()=>console.log(o),1e3)}x([...c])};p.useEffect(()=>{o.length>0&&!n?f():o.length===0&&m()},[o.length]);const T=async()=>{if(!r)return;if(c.some(t=>t.tab===r)){window.$message.warning(`${r} 已有`);return}let s=c.map(t=>t.tab).push(r);await h.post("/json-set",{ph:"tabs.json",data:s}).catch(t=>(window.$message.error("添加标签失败"),Promise.reject(t))),x([...c,{tab:r,color:b()}])},k=async()=>{if(!await window.$modal.confirm({okText:"删除",okType:"danger",maskClosable:!0,centered:!0,cancelText:"取消",title:"删除记录类型",content:"是否将（删除）"}))return;const t=c.filter(i=>{if(o.findIndex(_=>_.tab===i.tab)===-1)return i});await h.post("/json-set",{ph:"tabs.json",data:t.map(i=>i.tab)}).catch(i=>(window.$message.error(i),Promise.reject(i))),a([]),x(t)};return e.jsxs(v,{className:g.circleCard,title:e.jsxs("div",{className:"flex-ai-c",children:[e.jsx(l,{icon:"tag",size:"22",color:"var(--primary-color)",className:"mr-10"}),e.jsx("h4",{className:"wax-100 singe-line",children:"标签"})]}),children:[c.length?e.jsx(C,{size:[0,8],wrap:!0,className:"mt-10",children:c.map((s,t)=>e.jsx(S,{onChange:()=>u(s,t),checked:s.checked,children:e.jsx(y,{color:s.color,children:s.tab})},s.tab))}):e.jsx("div",{className:"flex-fdc-aic-juc w-100",children:e.jsx(l,{icon:"home",color:"var(--primary-color)",size:"24"})}),e.jsx(R.Item,{className:g.addForm+" w-100 mb-20",labelAlign:"right",children:e.jsxs(C.Compact,{className:"w-100",children:[e.jsx($,{placeholder:"标签名",onChange:s=>d(s.target.value)}),e.jsx(j,{type:"primary",icon:e.jsx(l,{icon:"add",size:16}),onClick:T,children:"提交"})]})}),e.jsx(z,{show:n,children:n?e.jsx(j,{danger:!0,type:"primary",block:!0,className:"mt-10",onClick:k,children:e.jsx(l,{icon:"delete",size:16})}):e.jsx(e.Fragment,{})})]})}const O=()=>{const[n,m]=p.useState([]),{setTabs:f,tabs:c}=N();F(()=>{h.post("/curd-mongo/find/tabs",{ops:{many:!0}}).then(a=>{m(a)})});const x=async(a,r)=>{(await h.post("/curd-mongo/del/tabs",{where:{_id:a}}).catch(u=>Promise.reject(u))).deletedCount?(n.splice(r,1),m([].concat(n)),window.$message.success("删除成功")):window.$message.success("删除失败")},o=async(a,r)=>{try{await h.post("/json-set",{ph:"tabs.json",data:c.map(d=>d.tab)}),f([...c,{tab:a.name,color:b()}]),n.splice(r,1),m([].concat(n))}catch(d){console.log(d),window.$message.error("操作失败")}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:g.view,children:[e.jsx(A,{}),e.jsx(v,{title:e.jsxs("div",{className:"flex",children:[e.jsx(l,{icon:"form",size:"22",color:"var(--primary-color)",className:"mr-10"}),e.jsx("h4",{className:"wax-100 singe-line",children:"申请的便签"})]}),children:n.length?n.map((a,r)=>e.jsxs("div",{className:"mt-10 mb-10 flex-ai-c",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{color:b(),children:a.name}),"说明：",a.txt]}),e.jsx(j,{danger:!0,type:"text",className:"ml-10",style:{backgroundColor:"var(--primary-color-suppl)",color:"#fff"},onClick:()=>o(a,r),children:e.jsx(l,{icon:"check",size:16})}),e.jsx(j,{danger:!0,type:"text",className:"ml-10",style:{backgroundColor:"#fff2f0"},onClick:()=>x(a._id,r),children:e.jsx(l,{icon:"delete",size:16})})]},a._id)):e.jsx("div",{className:"flex-fdc-aic-juc w-100",children:e.jsx(l,{icon:"home",color:"var(--primary-color)",size:"24"})})})]})})};export{O as default};
